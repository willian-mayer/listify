<!-- Mostrar Auth si no hay usuario logueado -->
<app-auth *ngIf="!currentUser"></app-auth>

<!-- Mostrar la app principal si hay usuario logueado -->
<div class="app-container" *ngIf="currentUser">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1>📝 Listify</h1>
      <p>Organiza tus tareas fácilmente</p>
    </div>
    <div class="header-user">
      <span class="user-name">👋 {{ currentUser.name }}</span>
      <button class="btn-logout" (click)="logout()">
        Cerrar sesión
      </button>
    </div>
  </header>

  <div class="main-content">
    <!-- Sidebar - Lists -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Mis Listas</h2>
        <button class="btn btn-primary" (click)="openListModal()">
          <span>+</span> Nueva Lista
        </button>
      </div>

      <div class="lists-container">
        <div 
          *ngFor="let list of lists" 
          class="list-card"
          [class.active]="selectedList?.id === list.id"
          (click)="selectList(list)">
          <div class="list-card-content">
            <h3>{{ list.title }}</h3>
            <p *ngIf="list.description">{{ list.description }}</p>
          </div>
          <div class="list-card-actions">
            <button 
              class="btn-icon" 
              (click)="openListModal(list); $event.stopPropagation()"
              title="Editar">
              ✏️
            </button>
            <button 
              class="btn-icon" 
              (click)="deleteList(list); $event.stopPropagation()"
              title="Eliminar">
              🗑️
            </button>
          </div>
        </div>

        <div *ngIf="lists.length === 0" class="empty-state">
          <p>No hay listas aún</p>
          <p class="empty-state-hint">Crea tu primera lista para comenzar</p>
        </div>
      </div>
    </aside>

    <!-- Main - Items -->
    <main class="items-section">
      <div *ngIf="selectedList" class="items-container">
        <div class="items-header">
          <div>
            <h2>{{ selectedList.title }}</h2>
            <p class="progress-text">
              {{ completedCount }} de {{ items.length }} completados
            </p>
          </div>
          <button class="btn btn-primary" (click)="openItemModal()">
            <span>+</span> Nuevo Item
          </button>
        </div>

        <div class="progress-bar">
          <div 
            class="progress-fill" 
            [style.width.%]="items.length ? (completedCount / items.length) * 100 : 0">
          </div>
        </div>

        <div class="items-list">
          <div 
            *ngFor="let item of items" 
            class="item-card"
            [class.checked]="item.checked">
            <label class="checkbox-container">
              <input 
                type="checkbox" 
                [checked]="item.checked"
                (change)="toggleItem(item)">
              <span class="checkmark"></span>
            </label>
            
            <span class="item-name">{{ item.name }}</span>
            
            <div class="item-actions">
              <button 
                class="btn-icon" 
                (click)="openItemModal(item)"
                title="Editar">
                ✏️
              </button>
              <button 
                class="btn-icon" 
                (click)="deleteItem(item)"
                title="Eliminar">
                🗑️
              </button>
            </div>
          </div>

          <div *ngIf="items.length === 0" class="empty-state">
            <p>No hay items en esta lista</p>
            <p class="empty-state-hint">Agrega tu primer item para comenzar</p>
          </div>
        </div>
      </div>

      <div *ngIf="!selectedList" class="empty-state-main">
        <div class="empty-state-icon">📋</div>
        <h2>Selecciona una lista</h2>
        <p>Elige una lista de la barra lateral para ver sus items</p>
      </div>
    </main>
  </div>
</div>

<!-- Modal for List -->
<div class="modal" *ngIf="showListModal" (click)="closeListModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Editar Lista' : 'Nueva Lista' }}</h2>
      <button class="btn-close" (click)="closeListModal()">×</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>Título *</label>
        <input 
          type="text" 
          [(ngModel)]="editingList.title"
          placeholder="Ej: Lista de compras"
          class="form-input"
          autofocus>
      </div>
      
      <div class="form-group">
        <label>Descripción</label>
        <textarea 
          [(ngModel)]="editingList.description"
          placeholder="Descripción opcional"
          class="form-input"
          rows="3"></textarea>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeListModal()">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="saveList()"
        [disabled]="!editingList.title?.trim()">
        {{ isEditMode ? 'Guardar' : 'Crear' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal for Item -->
<div class="modal" *ngIf="showItemModal" (click)="closeItemModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Editar Item' : 'Nuevo Item' }}</h2>
      <button class="btn-close" (click)="closeItemModal()">×</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>Nombre *</label>
        <input 
          type="text" 
          [(ngModel)]="editingItem.name"
          placeholder="Ej: Comprar leche"
          class="form-input"
          autofocus>
      </div>
      
      <div class="form-group" *ngIf="isEditMode">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="editingItem.checked">
          Completado
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeItemModal()">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="saveItem()"
        [disabled]="!editingItem.name?.trim()">
        {{ isEditMode ? 'Guardar' : 'Crear' }}
      </button>
    </div>
  </div>
</div>